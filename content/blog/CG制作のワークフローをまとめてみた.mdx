---
date: 2022-06-30T21:00:00.000+00:00
title: CG制作のワークフローをまとめてみた
thumbnail: https://res.cloudinary.com/dso4npatn/image/upload/v1662827570/media/blog/thumbnail/CG%E5%88%B6%E4%BD%9C%E3%81%AE%E3%83%AF%E3%83%BC%E3%82%AF%E3%83%95%E3%83%AD%E3%83%BC%E3%82%92%E3%81%BE%E3%81%A8%E3%82%81%E3%81%A6%E3%81%BF%E3%81%9F_ke1a2r.png
tag:
  - CG活
---

最近は自称 CG 活をしている。もともとアイアンマンに出てくるホログラムみたいな現実世界に CG が浸透していく世界への憧れがあったのでとても魅力的な分野だと感じている。

この記事ではそんな憧れや興味から入った素人の自分が制作に利用しているソフトウェアや参考にしているサイトなども混じえながら CG の全体像を把握するためにつらつらとまとめていく。あまり深い話まではいかず概要をさらっと撫でるのが本記事の目的になる。

## CG の用途と利用例

CG は非リアルタイムとリアルタイムに分かれる。非リアルタイムは映画やアニメなどの映像、リアルタイムはゲームが主な活用になる。
非リアルタイム CG は基本的にレンダリングという CG で制作した画像を 1 枚ずつ吐き出してそれをパラパラ漫画のようにアニメーションさせていく。CG アニメーションの場合だと基本は 24fps(1 秒あたりに 24 枚の画像が必要)なので、CG ソフトが 1 フレームをレンダリング(画像出力)するのに 5 秒かかるとすれば、10 秒のアニメーションを制作するだけでも 20 分はかかるという計算になる。もちろんレンダリング時間は出力するクオリティの設定やマシンスペックに依存するが、時間のかかる作業にはなる。ただリアルタイムと違ってプリレンダリングにはなるので出力に時間はかかっても CG としてのクオリティは追求できる。

> ##### 映像と CG
>
> 一口に映像で CG が使われているといっても使い所にはいろいろなパターンがある。奥が深い...
>
> - フル CG...トイストーリーみたいに映像にあるシーンすべてが CG で構築された表現
> - セルルック調...色情報のレベルを落とすことで手書きのイラストに寄せた表現にする(そうすることで背景は CG でキャラは手書き 2D でという工程にしてもシーンが CG 浮きせずに馴染む)
> - 実写 VFX...アメコミ映画みたいに実際の人間をグリーンバックで撮影して、その映像に対して CG による視覚効果を加える

リアルタイムの場合はインタラクティブに CG のシーンを提供しなくてはいけないので、それなりにレンダリングするコスト(ローポリ化やノイズの許容度)は下げてもパフォーマンスが求められる。よく言われるのが 60fps という目安だろう。近年は Unreal Engine や Unity などのフリーソフトの台頭によって個人でもかなりのクオリティの開発ができるようになってきている。

> ##### UE5 はすごいゲームエンジン
>
> Epic Games(フォートナイトの開発元)が開発している UE5 はゲームだけでなく映像でも使われる事例がかなり増加しており「リアルタイムレンダリングでここまでできるのかよ...」という CG 業界を震わせる存在となっている。CG アーティスト曰く「素人とプロの境界がなくなる」とも言われている。
>
> [Unreal Engine 5 Revealed! \| Next-Gen Real-Time Demo Running on PlayStation 5 - YouTube](https://www.youtube.com/watch?v=qC5KtatMcUw)
>
> <Youtube embededSrc="https://www.youtube.com/embed/qC5KtatMcUw" />
>
> UE5 になってアップデートされた機能でも以下はかなり革新的な技術になるらしい
>
> - Nanite...コストの高いハイポリゴンを知覚できる近いものは精度が高く、知覚できない遠いものは精度が低いように計算するシステム。これによってポリゴン数の制限が取り払われてリアルタイムレンダリングできてしまう。
> - Lumen...コストの高いレイトレーシングの計算をリアルタイムに精度の高い表現力で実現する動的グローバルイルミネーション。
> - Megascans...ゲーム制作用の高品質アセット。Nanite 対応している。

レンダリングについて話が出たが、基本的に CG でシーンをレンダリングする場合は３つの要素が必要になる。オブジェクト(シーンに映るキャラや物体)、ライト、カメラの３つである。この 3 つがあれば基本的にシーンとしてレンダリングすることが成立する。ライトがないと真っ暗で何も見えなかったり、カメラで映さないと何も始まらないので要注意。

CG を制作する上で初心者チュートリアルを見て CG ソフトの使い方を学ぶことも大事だが、まずは CG 制作の天井を見るという残酷さも大事だ。以下は CG アーティストさんがアップしているモデリングを実際に見れるサイトである。ローポリ(比較的ポリゴン数が少なくおもちゃっぽい CG)なものからフォトリアルなものまで実に表現の幅は広い。

> ##### CG アーティストの作品プラットフォーム
>
> - [Sketchfab - The best 3D viewer on the web](https://sketchfab.com/)
> - [CGSociety](https://cgsociety.org/)

## ワークフロー

本題のおおまかなワークフローを以下に示す。
CG 制作の内容によっては不要な工程もある。たとえばキャラクターがモデルでなければリギングやアニメーションは不要だし、映像ではなくゲームなどのリアルタイムレンダリングの場合コンポジットなども不要になる。

![cgw-flowchart.png](https://res.cloudinary.com/dso4npatn/image/upload/v1662840384/media/blog/insert/cgw-flowchart_xdysgg.jpg)

上記のさまざまな領域の作業をこなしてくれるツールが DCC ツールと呼ばれる統合型 3DCG ソフトウェアにあたる。基本的に DCC ツールを中心に CG 制作していき、各工程でのクオリティをより上げたい場合は各工程に特化したツールを利用するという判断になる。

> ##### DCC ツール
>
> 一応すべてのワークフローをこなせるツールになるが、今から始めるなら圧倒的に Blender だと思う。何より無料だし、ビッグテック企業が開発への投資を行なっていることからもコミュニティの成長はさらにすさまじくなっていく気がするソフトウェアである。
>
> - [Blender](https://www.blender.org/)
> - [Maya](https://www.autodesk.co.jp/products/maya)
> - [3ds Max](https://www.autodesk.co.jp/products/3ds-max)
> - [Cinema 4D](https://www.maxon.net/ja/cinema-4d)

### 1. モデリング

「**CG としての物体を形づくる**」工程である。

基本的には多角形(三角形や四角形)で構成されるポリゴンモデリングで点・線・面を切り替えながらツール機能を使って造形を行なっていく。点・線・面の形状を表す Shape ノードは位置・回転・サイズを表す Transform ノードをセットとして持っている。メカや家具などなカクカクしたデザイン(ソリッドモデリング)ではなく、キャラクターの形状など滑らかな表現をしたい場合はサブディビジョンモデリングで形をとっていく。

より複雑な造形を使っていく場合は Zbrush などのスカルプティングツールを用いてハイポリゴンなメッシュを作成して、それらをローポリ化するためにリトポロジーしていくようなケースもある。

> ##### スカルプティングツール
>
> - [ZBrush](https://oakcorp.net/pixologic/)

さらには対象物をさまざまなアングルから撮影して 3D 化したモデルを生成するフォトグラメトリなどの技術も最近では進化して当たり前になってきている。

### 2. テクスチャ/マテリアル

モデリングで作成した「**モデルに対しての色塗り**」の工程と考えればわかりやすい。ここで大事なのは単純な色味だけでなく、ライトにあたって見える質感などもここで表現できるということである。PBR(Physical Based Rendering)に基づいてレイトレーシングの計算を行うレンダリングエンジンがほとんどである。レイトレーシングの計算など難しいことはよくわからないが、PBR では色(Base Color)・金属感(Metalness)・物質の粗さ(Roughness)が重要な調整値となる。

またモデルへの色塗りを行う前にモデルを**UV 展開**(3 次元から 2 次元(UV 座標)の平面に)する必要がある。モデルのラッピングを解いていくイメージである。なのでモデリングからマテリアルを決める前に UV 展開を施しておく必要がある。

マテリアルの作成は Substance 3D Painter を使うとモデルがどのような質感になるか確認できるので簡単だが、Photoshop で自作のマテリアルを UV 座標に塗って DCC ツール上で確認する方法もある。Substance 3D Painter はよくマテリアルとして使われるアセットをツールとして提供しておりカスタムなども簡単に行える。UV 展開したモデルをインポートすれば Photoshop のようにレイヤーを分けてテクスチャを塗り重ねていくことができるので、これで汚れやシワなど細かい表現も実現可能だ。

> ##### マテリアルペイントツール
>
> - [Adobe Substance 3D Painter](https://www.adobe.com/jp/products/substance3d-painter.html)
>
> ![cgw-substance](https://res.cloudinary.com/dso4npatn/image/upload/v1662840385/media/blog/insert/cgw-substance_rt5qtk.png)

### 3. リギング/スキニング

この作業はモデリングにおいてキャラクターを作成した場合のみ発生し、「**キャラクターの身体や表情を動かす**」ための工程になる。キャラクターモデルに骨(Skeleton)を入れ、骨の動きに対してモデルの各頂点がどれくらい追従するかを決定する(Weight 調整)作業になる。

Skeleton 自体はヒューマン系のキャラクターであれば骨盤から脚や脊髄、腕、手先など大体の Skeleton の配置構成が決まっているのでそれに従って配置していく。配置できたらスキニングといってモデルの各頂点と Skeleton を紐付ける。これによってある程度自動で追従するようになるのだが、モデルを動かすと関節周りが極端に凹んだり膨らんだりする。これは頂点の追従する量(Weight)がツールの機能だと適切にならないことがあるためである。よってこれらを人間の手で調整する Weight 調整を行うことになる。

さらに Weight 調整後は骨や顔を数値のパラメーターで動的に動かすためのコントローラーを作成する。コントローラーを作成することでこの後のアニメーションの工程がかなり楽になる。

> ##### 自動リギング生成ツール
>
> - [Mixamo](https://www.mixamo.com/#/)
>
> モデルを FBX 形式でアップロードして各部位にマーカーを配置すると自動でリギングとウェイト調整まで行ってくれる。(← ただ完璧なウェイト調整じゃない場合もあり)さらにその後は短いモーションだがアニメーションの選択もできる。
> ![cgw-mixamo](https://res.cloudinary.com/dso4npatn/image/upload/v1662840385/media/blog/insert/cgw-mixamo_lptwrp.png)

### 4. アニメーション

「**キャラクターのポーズにキーを打つ**」工程になる。パラパラ漫画のイメージでポージングを決めて時間に対してキーフレームを打つ。

![cgw-animation](https://res.cloudinary.com/dso4npatn/image/upload/v1662840385/media/blog/insert/cgw-animation_olverj.png)

より滑らかに自然なアニメーションをつけるためにはアニメーションの 12 原則と言われる鉄則が存在しており、これらを参考にすると見てる側にとってナチュラルなアニメーションになるらしい。
アニメーションのグラフエディターなどから細かくアニメーションカーブを調整することで動きの減速や加速を細かく調整したりもできる。

> アニメーションの 12 原則
> [【アニメーションの 12 の原則】ディズニーから学ぶ映像作品の表現方法 \| LiCLOG](https://liclog.net/12-principal-of-animation/)

### 5. シミュレーション

自分自身シミュレーションに関して知識が浅く理解していない部分が多いが、「**オブジェクトに物理演算を施す**」工程にあたる。この工程自体も使う場面は限られているので必要に応じて..という工程になるが計算量も多く「ザ・CG」という感じかもしれない。

よくあるのは Cloth シミュレーションで布が落ちるシーンを再現するというものである。落ちるスピード(重力加速度)や物体の薄さ、反発力、摩擦などを設定してツール上でシミュレーションを行う。他にも髪の毛などの毛並みや液体などの流体、物体の衝突/破壊シミュレーションなどがある。

> ##### シミュレーションツール
>
> Houdini は使ったことがないのでもしかしたら DCC ツールに分類される(なんでもできる)ジャンルかもしれないが、VFX などシミュレーション系が強いと聞いている。
>
> - [Houdini](https://www.sidefx.com/ja/products/houdini/)

### 6. カメラ・ライト

この工程はそのままの意味になるが、「**シーン内に作ったオブジェクトの撮影をするためのカメラとライトの配置をする**」工程である。

カメラに関してはアニメーションを撮影する場合はカメラ自身も動く場合があるのでそれを意識した配置をする必要がある。
また、カメラレンズの広角や焦点(被写界深度)を調整できるのでカメラ設定値から操作して撮影範囲をコントロールする。

ライトに関しては、PointLight(全方向に発行するライト), DirectionLight(太陽光のように平行に進むライト), AreaLight(撮影セットのような長方形のライト), SpotLight(懐中電灯のような円錐状に照らすライト)などさまざまな種類がありそれらをうまく利用しながら自分の表現したいライティングを実現していく。
参考となるのは**レンブラントライティング(三点証明)**と言われるキーライト、フィルライト、バックライトの 3 つで構成する光の当て方だろう。ただし表現したいシーンによってそれで全て正解にはならないのでレンダリングしながら適切なライト配置を決めていく。

### 7. レンダリング

ここまで作成してきた「**シーンを出力**」する工程にあたる。前述の通りリアルタイムか否かでゲームエンジンを使うのか、DCC ツールを使うのかは変わってくる。

構築したシーン(モデル+カメラ+ライト)を１枚の画像、アニメーションであればフレーム枚数分の画像を出力するが、レンダリングエンジンも Blender であれば Cycles か Eevee、Maya であれば Arnold とツールによって異なる。レンダリング後の画像の見え方が少し変わってくるので必要あらばレンダリング設定で調整を行う必要がある。
よくあるのはノイズ調整だろう。ノイズ軽減はレイトレーシングの結果によって調整する箇所が異なったりもするがレンダリング設定のサンプル数をあげることで解決したりもする。他にも光の反射回数を調整できたりするので、光と影やマテリアルの性質に加えてそれらの設定がどのような影響を与えるのかを理解しておくことが非常に重要になる。

### 8. コンポジット

「**CG 素材の抽出と合成**」をする工程にあたる。コンポジットの工程自体は映像製作者向けの作業となる。プリレンダリングで出力した映像にエフェクトを足してより自分の表現したい世界観に近づけていく。

たとえば、映像を表現する上で背景は少しぼかして、キャラクターやメインに移したいオブジェクトをはっきりさせたいシーンを撮りたい時などがある。

その際に今までの工程で行ったシーンを一発でレンダリングしてしまうと、背景だけやメインだけを AfterEffects などの映像編集で抽出する必要が出て編集がしづらくなる。そこで CG 側であらかじめ素材として、レンダリングするレイヤーを分けレンダリングを行う。
具体的には以下のようなレンダリングレイヤー構成などがある。(あくまで参考例)

![cgw-composite](https://res.cloudinary.com/dso4npatn/image/upload/v1662840384/media/blog/insert/cgw-compsite_mdlzi3.png)

- `Background`..背景だけ
- `Character`...キャラだけ
- `Ambient Occulusion`...オブジェクト自体が持つ影
- `Shadow`...ライトによって直接つくられる影
- `Depth`...被写界深度

> ##### CG によるシーンの編集ツール
>
> - [Adobe After Effects](https://www.adobe.com/jp/products/aftereffects.html)
> - [Nuke](https://www.foundry.com/ja/products/nuke-family/nuke)

## まとめ

自分自身各工程で深い部分まで理解していないこともあるので作業をする中でまた細かい部分をまとめていけたらと思う。

CG は制作の対象によって踏む工程も変わるので、本当幅も奥行きも深いなと思い知らされる。ツールも操作を覚えだけで大変だったりもするがこういった CG 制作がより身近に触れられ楽しめる時代になっていくことを自分は期待している。
